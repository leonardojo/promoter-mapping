{
    "collab_server" : "",
    "contents" : "---\ntitle: \"version_two\"\nauthor: \"Leonardo Jo\"\ndate: \"June 9, 2017\"\noutput:\n  html_document: default\n  pdf_document: default\n---\n\n```{r error=T}\n# Promoter Mapping v1.2\n## install.packages(\"tidyverse\")\nlibrary(tidyverse)\noptions(stringsAsFactors = F)\n\n## Organizing the table\n## Table Motifs_Promoters.bed are the result of intersect bed \n## of a BED file containing the coordinates of the promoter 600bp (-500,+100)\n## and a BED file containing the coordinates of the motifs and TSS\n## Files are in ~/BED_Files\ntable <- read.table('Motifs_Promoters.bed', header = F, sep = \"\\t\")\ntable <- table[,-7]\nnames(table)[7:12] <- c(\"V7\",\"V8\",\"V9\",\"V10\",'V11',\"V12\")\nnames(table)[4] <- \"Genes\"\nhead(table)\n\n## Setting up coordinates for each motif in the promoter based on their position on chromossomes\n\ntable$V8 <- table$V8 - table$V2 ## Start\ntable$V9 <- table$V9 - table$V2 ## Stop\nhead(table)\n\n## Setting up coordinates for START and STOP for each motif adjusting Strand Orientation, \n## For instance, if a gene is on the negative strand, motifs that are in position 10 will be placed on (PROMOTER SIZE) - 10\n\ntable$motif.start[table$V6 == \"+\"] <- table[table$V6 == \"+\", 8] ## Gene on positive strand, just copy the start from orignal\ntable$motif.stop[table$V6 == \"+\"] <- table[table$V6 == \"+\", 9] ## Gene on positive strand, just copy the STOP from orignal\n\ntable$motif.start[table$V6 == \"-\"] <- (table[table$V6 == \"-\", 3]-table[table$V6 == \"-\", 2]) - table[table$V6 == \"-\", 9] ## Gene on negative strand, promoter size (V3 - V2) minus stop\ntable$motif.stop[table$V6 == \"-\"] <- (table[table$V6 == \"-\", 3]-table[table$V6 == \"-\", 2]) - table[table$V6 == \"-\", 8] ## Gene on negative strand, promoter size (V3 - V2) minus start\n\n## Setting up the middle point of the motif\ntable$motif.middle <- table$motif.start + as.numeric((table$motif.stop-table$motif.start)/2)\n\nhead(table)\n\n## Subset table from a gene list\ngene.list <- read.table(\"EM LEARBZAB DT.txt\", header = F)\ntable.s <- merge(table, gene.list, by.x = \"Genes\", by.y = \"V1\")\n\n## Preparing for ploting\n\n##Setting up scale points in the map (it will divide into pieces of 100 bp)\npromoter.size <- as.numeric(table[1,3] - table[1,2]-1) ## They all need to be the same\npoint <- data.frame(seq.int(0,promoter.size, by = 100))\nnames(point) <- \"X\"\n\n## This is a sample, so it will only do it for the first 20 genes\ntable.s <- table.s[c(1:20),]\n\n##Setting up image size \nh <- n_distinct(table.s$Genes)/4\n\nggplot(data = table.s) + \n  \n  ## Motifs in the positive strand of genes in positive strand\n  geom_point(data = subset(table.s, (V6 == \"+\") & (V12 == \"+\") & (V10 != \"TSS\")), aes(x=motif.middle, y= 0.25, fill = V10), shape = 25, size = 2) + \n  ## Motifs in the negative strand of genes in positive strand\n  geom_point(data = subset(table.s, (V6 == \"+\") & (V12 == \"-\") & (V10 != \"TSS\")), aes(x=motif.middle, y= -0.25, fill = V10), shape = 24, size = 2, show.legend = FALSE) + \n  ## Motifs in the positive strand of genes in negative strand\n  geom_point(data = subset(table.s, (V6 == \"-\") & (V12 == \"+\") & (V10 != \"TSS\")), aes(x=motif.middle, y= -0.25, fill = V10), shape = 24, size = 2, show.legend = FALSE) +\n  ## Motifs in the negative strand of genes in negative strand\n  geom_point(data = subset(table.s, (V6 == \"-\") & (V12 == \"-\") & (V10 != \"TSS\")), aes(x=motif.middle, y= -0.25, fill = V10), shape = 25, size = 2, show.legend = FALSE) +\n  \n  #TSS\n  geom_point(data = subset(table.s, V10 == \"TSS\"), aes(x=motif.middle, y= 0, colour= \"TSS\"), fill = \"grey20\", shape = 18, size = 2) + \n  \n  # Adding the scale points in the promoter\n  geom_point(data = point, aes(x= X, y =0.0), fill= \"grey20\", shape = 108, size = 2) +\n  \n  xlim(0,promoter.size) + \n  ylim(-0.80,0.80) +\n  \n  theme_bw() +\n  coord_fixed(ratio = 100) +\n  \n  facet_wrap(\"Genes\", ncol= 3) +\n  geom_segment(aes(x=0,xend=promoter.size,y=0,yend=0)) +\n  scale_fill_manual(values=c(\"red2\",\"lightgreen\",\"dodgerblue\")) +\n  scale_colour_manual(values=c(\"grey20\")) +\n  theme(legend.position = \"top\", legend.title = element_blank(),\n        axis.title.y=element_blank(), axis.title.x = element_blank(), axis.text.y=element_blank(), \n        axis.ticks.y=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())\n\n\ndev.off()\n```\n\n",
    "created" : 1497048234651.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3090981482",
    "id" : "E74BF20B",
    "lastKnownWriteTime" : 1497049929,
    "last_content_update" : 1497049929511,
    "path" : "D:/Current Users/Leo Jo/Bioinfo Data/promoter-mapping/version_two.Rmd",
    "project_path" : "version_two.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}