{
    "collab_server" : "",
    "contents" : "# Promoter Mapping v1.3\n## install.packages(\"tidyverse\")\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(ggplot2)\noptions(stringsAsFactors = F)\n\n## Organizing the table\n## Table Motifs_Promoters.bed are the result of intersect bed \n## of a BED file containing the coordinates of the promoter 600bp (-500,+100)\n## and a BED file containing the coordinates of the motifs and TSS\n## Files are in ~/BED_Files\n## Promoter Chr - Promoter Start - Promoter Stop - Genes - phytozomev10 - Promoter Strand - Motif Chr - Motif Start - Motif Stop - Motif Name - Motid Score - Motif Strand\ntable <- read.table('Motifs.Promoter.bed', header = F, sep = \"\\t\")\ntable <- table[,-7] ## Removing column 7, represents the number of each motif\n\n## Adding names to the Promoter Side of the table (P.***)\nnames(table)[1:6] <- c(\"P.Chr\",\"P.Start\",\"P.Stop\",\"Genes\",'Phyto',\"P.Strand\")\n\n## Adding names to the Motif Side of the table (M.***)\nnames(table)[7:12] <- c(\"M.Chr\",\"M.Start\",\"M.Stop\",\"Motif\",'M.Score',\"M.Strand\")\n\nhead(table)\n\n## Setting up coordinates for each motif in the promoter based on their position on chromossomes\ntable$Coord.Start.temp <- table$M.Start - table$P.Start ## Start\ntable$Coord.Stop.temp <- table$M.Stop - table$P.Start ## Stop\nhead(table)\n\n## Setting up coordinates for START and STOP for each motif adjusting Strand Orientation, \n## For instance, if a gene is on the negative strand, motifs that start in position 10 and end in position 15 will be placed on (PROMOTER SIZE) - 15\n\ntable$Coord.Start[table$P.Strand == \"+\"] <- \n  table[table$P.Strand == \"+\", 13] ## Maintain START if Gene is in the + Strand\ntable$Coord.Stop[table$P.Strand == \"+\"] <- \n  table[table$P.Strand == \"+\", 14] ## Maintain STOP if Gene is in the + Strand\n\ntable$Coord.Start[table$P.Strand == \"-\"] <- \n  (table[table$P.Strand == \"-\", 3]- table[table$P.Strand == \"-\", 2]) - table[table$P.Strand == \"-\", 14] ## Gene on negative strand, promoter size (Column 3 - Column 2) minus Coord.stop\ntable$Coord.Stop[table$P.Strand == \"-\"] <- \n  (table[table$P.Strand == \"-\", 3]- table[table$P.Strand == \"-\", 2]) - table[table$P.Strand == \"-\", 13] ## Gene on negative strand, promoter size (V3 - V2) minus start\n\nhead(table)\n\n## Removing TEMP Columns\ntable <- table[-c(13,14)]\n\n## Setting up the middle point of the motif\ntable$Motif.Middle <- table$Coord.Start + as.numeric((table$Coord.Stop-table$Coord.Start)/2)\n\nhead(table)\n\n## Subset table from a gene list\n## Gene List is a tab delimited text file with a list of genes that you want to subset\ngene.groups <- list.files(pattern = \"DT.txt\")\n\nfor (i in gene.groups){\ngene.list <- read.table(paste(i), header = F)\n\ntable.subset <- merge(table, gene.list, by.x = \"Genes\", by.y = \"V1\")\n\nhead(table.subset)\n\n## Preparing for ploting\n\n##Setting up scale points in the map (it will add scale into the maps 100 bp)\npromoter.size <- as.numeric(table[1,3] - table[1,2]-1) ## They all need to be the same\npoint <- data.frame(seq.int(0,promoter.size, by = 100))\nnames(point) <- \"X\"\n\n##Do you want to check the plot first? I recommend reducing the number of genes\n## table.subset <- table.subset[c(1:30),]\n\n##Setting up image size\nh <- n_distinct(table.subset$Genes)/8\n\n## In the future: Order genes based on expression\nname <- paste(substr(i,1,nchar(i)-4),\"png\",sep=\".\")\na <- ggplot(data = table.subset) + \n  \n  ## Motifs in the positive strand of genes in positive strand\n  geom_point(data = subset(table.subset, (P.Strand == \"+\") & (M.Strand == \"+\") & (Motif != \"TSS\")), aes(x=Motif.Middle, y= 0.4, fill = Motif), shape = 25, size = 2) + \n  ## Motifs in the negative strand of genes in positive strand\n  geom_point(data = subset(table.subset, (P.Strand == \"+\") & (M.Strand == \"-\") & (Motif != \"TSS\")), aes(x=Motif.Middle, y= -0.4, fill = Motif), shape = 24, size = 2, show.legend = FALSE) + \n  ## Motifs in the positive strand of genes in negative strand\n  geom_point(data = subset(table.subset, (P.Strand == \"-\") & (M.Strand == \"+\") & (Motif != \"TSS\")), aes(x=Motif.Middle, y= -0.4, fill = Motif), shape = 24, size = 2, show.legend = FALSE) +\n  ## Motifs in the negative strand of genes in negative strand\n  geom_point(data = subset(table.subset, (P.Strand == \"-\") & (M.Strand == \"-\") & (Motif != \"TSS\")), aes(x=Motif.Middle, y= 0.4, fill = Motif), shape = 25, size = 2, show.legend = FALSE) +\n  \n  #TSS\n  geom_point(data = subset(table.subset, Motif == \"TSS\"), aes(x=Motif.Middle, y= 0, colour= \"TSS\"), fill = \"grey20\", shape = 18, size = 2) + \n  \n  # Adding the scale points in the promoter\n  geom_point(data = point, aes(x= X, y =0.0), fill= \"grey20\", shape = 108, size = 2) +\n  \n  xlim(0,promoter.size) + \n  ylim(-0.80,0.80) +\n  \n  theme_bw() +\n  coord_fixed(ratio = 100) +\n  \n  facet_wrap(\"Genes\", ncol= 5) +\n  geom_segment(aes(x=0,xend=promoter.size,y=0,yend=0)) +\n  scale_fill_manual(values=c(\"green3\",\"red2\",\"greenyellow\",\"dodgerblue\")) +\n  scale_colour_manual(values=c(\"grey20\")) +\n  theme(legend.position = \"top\", legend.title = element_blank(),\n        axis.title.y=element_blank(), axis.title.x = element_blank(), axis.text.y=element_blank(), \n        axis.ticks.y=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) \n\na + \n  ggsave(file = name, dpi = 600, width = 10, height = as.numeric(h), units = \"in\", limitsize = F)\n\n}\n\n",
    "created" : 1497048122417.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "84534125",
    "id" : "E13B0D57",
    "lastKnownWriteTime" : 1497058732,
    "last_content_update" : 1497058732814,
    "path" : "D:/Current Users/Leo Jo/Bioinfo Data/promoter-mapping/version_two.R",
    "project_path" : "version_two.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}